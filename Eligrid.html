<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <style>
        .map {
            width: auto;
            overflow-x: scroll;
            overflow-y: scroll;
        }

        td {
            width: auto;
            position: relative;
        }

        td:after {
            content: '';
            display: block;
            margin-top: 0%;
        }

        td .square {
            width: 50px;
            height: 50px;
            position: relative;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            background: peachpuff;
        }

        td .square:hover {
            background: burlywood;
        }

        .context-menu {
            background: snow;
            width: 200px;
            height: auto;
            box-shadow: 0 0 20px 0 #ccc;
            position: absolute;
            display: none;
        }

        .context-menu ul {
            list-style: none;
            padding: 5px 0px 5px 0px;
        }

        .context-menu ul li:not(.separator) {
            padding: 10px 5px 10px 5px;
            border-left: 4px solid transparent;
            cursor: pointer;
        }

        .context-menu ul li:hover {
            background: #eee;
            border-left: 4px solid #666;
        }

        .posindicator {
            background: whitesmoke;
        }

        .separator {
            height: 1px;
            background: #dedede;
            margin: 2px 0px 2px 0px;
        }

        #line {
            width: 200px;
            height: 3px;
            border: solid thin transparent;
            position: absolute;
            background-color: red;
        }

        #line:hover {
            background-color: maroon;
        }
    </style>
</head>

<body>
    <table class='map'></table>
    <div id='contextMenu' class='context-menu'>
        <ul>
            <li class='posindicator'>좌표=
                <span id='pos'></span>
            </li>
            <li onclick='expandRowBefore(event)'>위에 행 추가</li>
            <li onclick='expandRowAfter(event)'>아래에 행 추가</li>
            <li onclick='expandColBefore(event)'>왼쪽에 열 추가</li>
            <li onclick='expandColAfter(event)'>오른쪽에 열 추가</li>
            <li class='separator'></li>
            <li>Hide this</li>
        </ul>
    </div>
    <div id="line" style="top: 133.076px; left: 80.0434px; width: 255.947px; transform: rotate(-175.069deg);"></div>
</body>
<script>
    function Initialize() {
        var map = document.querySelector('.map');
        for (i = 0; i < 10; i++) {
            var newrow = map.insertRow();
            for (j = 0; j < 10; j++) {
                var newcol = newrow.insertCell();
                newcol.innerHTML = '<div class="square">1</div>';
                newcol.oncontextmenu = function (event) {
                    return showContextMenu(event);
                };
            }
        }
    }
    Initialize();


    //
    function expandRowAfter(event) {
        var str = event.path[1].querySelector('#pos').innerHTML;
        var array = JSON.parse(str);
        var map = document.querySelector('.map');
        var ncols = map.rows[0].cells.length;
        var newrow = map.insertRow(array[0]);
        for (i = 0; i < ncols; i++) {
            var newcol = newrow.insertCell();
            newcol.innerHTML = '<div class="square"></div>';
            newcol.oncontextmenu = function (event) {
                return showContextMenu(event);
            };
        }
    }

    function expandRowBefore(event) {
        var str = event.path[1].querySelector('#pos').innerHTML;
        var array = JSON.parse(str);
        var map = document.querySelector('.map');
        var ncols = map.rows[0].cells.length;
        var newrow = map.insertRow(array[0] - 1);
        for (i = 0; i < ncols; i++) {
            var newcol = newrow.insertCell();
            newcol.innerHTML = '<div class="square"></div>';
            newcol.oncontextmenu = function (event) {
                return showContextMenu(event);
            };
        }
    }

    function expandColBefore(event) {
        var str = event.path[1].querySelector('#pos').innerHTML;
        var array = JSON.parse(str);
        var map = document.querySelector('.map');
        var nrows = map.rows.length;
        // var newrow = map.insertRow(array[1]);
        for (i = 0; i < nrows; i++) {
            var newcell = map.rows[i].insertCell(array[1] - 1);
            newcell.innerHTML = '<div class="square"></div>';
            newcell.oncontextmenu = function (event) {
                return showContextMenu(event);
            };
        }
    }

    function expandColAfter(event) {
        var str = event.path[1].querySelector('#pos').innerHTML;
        var array = JSON.parse(str);
        var map = document.querySelector('.map');
        var nrows = map.rows.length;
        // var newrow = map.insertRow(array[1]);
        for (i = 0; i < nrows; i++) {
            var newcell = map.rows[i].insertCell(array[1]);
            newcell.innerHTML = '<div class="square"></div>';
            newcell.oncontextmenu = function (event) {
                return showContextMenu(event);
            };
        }
    }

    function getPos(element) {
        return [element.parentNode.rowIndex, element.cellIndex];
    }

    var squares = document.querySelectorAll('.square')
    for (let square of squares) {
        square.oncontextmenu = function (event) {
            return showContextMenu(event);
        };
    }

    window.onclick = hideContextMenu;
    window.onkeydown = listenKeys;
    var contextMenu = document.querySelector('#contextMenu');

    function showContextMenu(event) {
        contextMenu.style.display = 'block';
        contextMenu.style.left = event.clientX + 'px';
        contextMenu.style.top = event.clientY + 'px';
        var pos = getPos(event.path[1]);
        document.querySelector('#pos').innerHTML = '[' + (pos[0] + 1) + ',' + (pos[1] + 1) + ']';
        return false;
    }

    function hideContextMenu() {
        contextMenu.style.display = 'none';
    }

    function listenKeys(event) {
        var keyCode = event.which || event.KeyCode;
        if (keyCode == 27) { // ESC키
            hideContextMenu();
        }
    }

    // document.addEventListener('mousemove', onMouseMove);

    // function onMouseMove(event) {
    //     moveAt(event.pageX, event.pageY);
    // }

    // function moveAt(pageX, pageY) {
    //     ball.style.left = pageX - ball.offsetWidth / 2 + 'px';
    //     ball.style.top = pageY - ball.offsetHeight / 2 + 'px';
    // }
</script>

</html>